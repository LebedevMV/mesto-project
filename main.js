(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>Q});var t=function(e,t,r){return function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.add(r.inactiveButtonClass),t.setAttribute("disabled","")):(t.classList.remove(r.inactiveButtonClass),t.removeAttribute("disabled"))},r=function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(r){r.addEventListener("submit",(function(e){e.preventDefault()})),function(e,r){var n=Array.from(e.querySelectorAll(r.inputSelector)),o=e.querySelector(r.submitButtonSelector);null!=o&&(t(n,o,r),n.forEach((function(c){return c.addEventListener("input",(function(){t(n,o,r),function(e,t,r){t.validity.valid?function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));n.textContent="",t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass)}(e,t,r):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));o.textContent=r,t.classList.add(n.inputErrorClass),o.classList.add(n.errorClass)}(e,t,t.validationMessage,r)}(e,c,r)}))})),e.addEventListener("submit",(function(){t(n,o,r)})))}(r,e)}))},n={baseUrl:"https://nomoreparties.co/v1/plus-cohort-6",headers:{Authorization:"dd10102a-a17f-4587-9268-977fde4c50fb","Content-Type":"application/json"}},o=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},c=document.querySelector(".page"),i=c.querySelector("#edit-profile"),a=i.querySelector(".pop-up__main-container"),u=c.querySelector(".profile__edit-button"),l=i.querySelector(".pop-up__item_el_name"),s=i.querySelector(".pop-up__item_el_bio"),p=i.querySelector(".pop-up__submit"),d=c.querySelector(".profile__name"),_=c.querySelector(".profile__bio"),f=c.querySelector(".profile__avatar"),m=document.querySelectorAll(".pop-up"),v=c.querySelector("#change-ava"),y=c.querySelector(".profile__overlay"),h=v.querySelector(".pop-up__main-container"),S=v.querySelector("#ava-link"),b=v.querySelector(".pop-up__submit"),g=function(e,t){d.textContent=e,_.textContent=t},q=function(e){f.setAttribute("src",e)};function L(e){return!e.classList.contains("pop-up_is-closed")}function k(e){"Escape"===e.key&&E(Array.from(m).find(L))}function C(e){e.classList.remove("pop-up_is-closed"),document.addEventListener("keydown",k)}function E(e){e.classList.add("pop-up_is-closed"),document.removeEventListener("keydown",k)}var x=document.querySelector("#add-image"),A=x.querySelector(".pop-up__main-container"),w=document.querySelector(".profile__add-button"),B=x.querySelector(".pop-up__submit"),U=document.querySelector(".elements"),O=document.querySelector("#card").content,j=document.querySelector("#view-image"),P=document.querySelector(".pop-up__view-image"),T=document.querySelector(".pop-up__image-title"),D=x.querySelector(".pop-up__item_el_image-link"),N=x.querySelector(".pop-up__item_el_title"),I=function(e){var t=J();return H(e,t),$(e,t),z(e,t),F(t),t},J=function(){return O.querySelector(".card").cloneNode(!0)},H=function(e,t){var r=t.querySelector(".card__image"),n=t.querySelector(".card__like-counter");r.src=e.link,r.alt=e.name,e.owner._id!=Q&&t.querySelector(".card__delete-button").remove(),t.querySelector(".card__text").textContent=e.name,e.likes.length>0&&(n.textContent=e.likes.length,n.classList.add("card__like-counter_active")),function(e,t){var r=t.querySelector(".card__like");M(e)?r.classList.add("card__like_active"):r.classList.remove("card__like_active")}(e,t)},M=function(e){return e.likes.some((function(e){return e._id===Q}))},z=function(e,t){var r=t.querySelector(".card__like"),c=t.querySelector(".card__like-counter");r.addEventListener("click",(function(t){var r;t.target.classList.contains("card__like_active")?(r=e._id,fetch("".concat(n.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:n.headers}).then((function(e){return o(e)}))).then((function(e){return t.target.classList.remove("card__like_active"),e})).then((function(e){c.textContent=e.likes.length,e.likes.length>0?c.classList.add("card__like-counter_active"):c.classList.remove("card__like-counter_active")})).catch((function(e){console.log("".concat(e,":Не удалось снять лайк"))})):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then((function(e){return o(e)}))}(e._id).then((function(e){return t.target.classList.add("card__like_active"),e})).then((function(e){c.textContent=e.likes.length,e.likes.length>0?c.classList.add("card__like-counter_active"):c.classList.remove("card__like-counter_active")})).catch((function(e){console.log("".concat(e,":Не удалось поставить лайк"))}))}))},$=function(e,t){var r=t.querySelector(".card__delete-button");null!=r&&r.addEventListener("click",(function(r){var c;(c=e._id,fetch("".concat(n.baseUrl,"/cards/").concat(c),{method:"DELETE",headers:n.headers}).then((function(e){return o(e)}))).then((function(e){t.remove()})).catch((function(e){console.log(e)}))}))},F=function(e){e.querySelector(".card__image").addEventListener("click",(function(e){G(e)}))},G=function(e){P.src=e.target.src,P.alt=e.target.alt,T.textContent=e.target.alt,C(j)};function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Q="";r({formSelector:".pop-up",inputSelector:".pop-up__item",submitButtonSelector:".pop-up__submit",inactiveButtonClass:"pop-up__submit_disabled",inputErrorClass:"pop-up__item_type_error",errorClass:"pop-up__item-error_active"}),A.addEventListener("submit",(function(){B.textContent="Сохранение";var e={};e.link=D.value,e.name=N.value,function(e,t){return fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return o(e)}))}(e.name,e.link).then((function(e){return U.prepend(I(e)),N.value="",D.value="",e})).then((function(e){E(x)})).catch((function(e){console.log(e)})).finally((function(e){B.textContent="Сохранить"}))})),w.addEventListener("click",(function(){C(x),r({formSelector:".pop-up",inputSelector:".pop-up__item",submitButtonSelector:".pop-up__submit",inactiveButtonClass:"pop-up__submit_disabled",inputErrorClass:"pop-up__item_type_error",errorClass:"pop-up__item-error_active"})})),u.addEventListener("click",(function(){l.value=d.textContent,s.value=_.textContent,C(i),r({formSelector:".pop-up",inputSelector:".pop-up__item",submitButtonSelector:".pop-up__submit",inactiveButtonClass:"pop-up__submit_disabled",inputErrorClass:"pop-up__item_type_error",errorClass:"pop-up__item-error_active"})})),a.addEventListener("submit",(function(e){var t,r;p.textContent="Сохранение",e.preventDefault(),(t=l.value,r=s.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:r})}).then((function(e){return o(e)}))).then((function(e){g(e.name,e.about),E(i)})).catch((function(e){console.log(e)})).finally((function(e){p.textContent="Сохранить"}))})),y.addEventListener("click",(function(){C(v),r({formSelector:".pop-up",inputSelector:".pop-up__item",submitButtonSelector:".pop-up__submit",inactiveButtonClass:"pop-up__submit_disabled",inputErrorClass:"pop-up__item_type_error",errorClass:"pop-up__item-error_active"})})),h.addEventListener("submit",(function(){var e;b.textContent="Сохранение",(e=S.value,fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:e})}).then((function(e){return o(e)}))).then((function(e){return q(e.avatar),E(v),S.value="",e})).catch((function(e){console.log(e)})).finally((function(e){b.textContent="Сохранить"}))})),Array.from(m).forEach((function(e){e.addEventListener("mousedown",(function(t){!t.target.classList.contains("pop-up_is-closed")&&t.target.classList.contains("pop-up")&&E(e),t.target.classList.contains("pop-up__close")&&E(e)}))})),console.log(Q),Promise.all([fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then((function(e){return o(e)})),fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then((function(e){return o(e)}))]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c=[],i=!0,a=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return K(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?K(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],c=n[1];Q=o._id,g(o.name,o.about),q(o.avatar),c.forEach((function(e){return U.append(I(e))}))})).then((function(e){document.querySelector(".loader").classList.remove("loader_active")})).catch((function(e){return console.log(e)}))})();