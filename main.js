(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>Q});var t=function(e,t,n){return function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","")):(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled"))},n={baseUrl:"https://nomoreparties.co/v1/plus-cohort-6",headers:{Authorization:"dd10102a-a17f-4587-9268-977fde4c50fb","Content-Type":"application/json"}},o=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},r=function(){return fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then((function(e){return o(e)}))},c=function(){return fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then((function(e){return o(e)}))},u=document.querySelector(".page"),i=u.querySelector("#edit-profile"),a=i.querySelector(".pop-up__main-container"),l=u.querySelector(".profile__edit-button"),s=i.querySelector(".pop-up__item_el_name"),d=i.querySelector(".pop-up__item_el_bio"),f=(i.querySelector(".pop-up__submit"),u.querySelector(".profile__name")),p=u.querySelector(".profile__bio"),_=u.querySelector(".profile__avatar"),m=document.querySelectorAll(".pop-up"),h=u.querySelector("#change-ava"),v=u.querySelector(".profile__overlay"),y=h.querySelector(".pop-up__main-container"),S=function(e,t){f.textContent=e,p.textContent=t},b=function(e){_.setAttribute("src",e)},q=Array.from(document.querySelectorAll(".pop-up"));function g(e){return!e.classList.contains("pop-up_is-closed")}function L(e){"Escape"===e.key&&k(Array.from(m).find(g))}function E(e){e.classList.remove("pop-up_is-closed"),document.addEventListener("keydown",L)}function k(e){e.classList.add("pop-up_is-closed"),document.removeEventListener("keydown",L)}var C=document.querySelector("#add-image"),x=C.querySelector(".pop-up__main-container"),A=document.querySelector(".profile__add-button"),U=(C.querySelector(".pop-up__submit"),document.querySelector(".elements")),w=document.querySelector("#card").content,O=document.querySelector("#view-image"),P=document.querySelector(".pop-up__view-image"),T=document.querySelector(".pop-up__image-title"),j=C.querySelector(".pop-up__item_el_image-link"),B=C.querySelector(".pop-up__item_el_title"),D=function(e){e.forEach((function(e){return U.prepend(J(e))}))},N=function(){Array.from(U.querySelectorAll(".card")).forEach((function(e){e.remove()}))},J=function(e){var t=H();return z(e,t),G(e,t),F(e,t),I(t),t},H=function(){return w.querySelector(".card").cloneNode(!0)},z=function(e,t){var n=t.querySelector(".card__image"),o=t.querySelector(".card__like-counter");n.src=e.link,n.alt=e.name,e.owner._id!=Q&&t.querySelector(".card__delete-button").remove(),t.querySelector(".card__text").textContent=e.name,e.likes.length>0&&(o.textContent=e.likes.length,o.classList.add("card__like-counter_active")),function(e,t){var n=t.querySelector(".card__like");M(e)?n.classList.add("card__like_active"):n.classList.remove("card__like_active")}(e,t)},M=function(e){return e.likes.some((function(e){return"323ee26df72d5d21befc57c5"===e._id}))},F=function(e,t){t.querySelector(".card__like").addEventListener("click",(function(t){var r;M(e)?(r=e._id,fetch("".concat(n.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:n.headers}).then((function(e){return o(e)}))).catch((function(e){console.log("Не удалось снять лайк")})).finally((function(e){c().then((function(e){return N(),e})).then((function(e){D(e)})).catch((function(e){console.log(e)}))})):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then((function(e){return o(e)}))}(e._id).then((function(e){return t.target.classList.add("card__like_active"),e})).catch((function(e){console.log("Не удалось поставить лайк")})).finally((function(e){c().then((function(e){return N(),e})).then((function(e){D(e)})).catch((function(e){console.log(e)}))}))}))},G=function(e,t){var r=t.querySelector(".card__delete-button");null!=r&&r.addEventListener("click",(function(t){var r;(r=e._id,fetch("".concat(n.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:n.headers}).then((function(e){return o(e)}))).catch((function(e){console.log(e)})).finally((function(e){c().then((function(e){return N(),e})).then((function(e){D(e)})).catch((function(e){console.log(e)}))}))}))},I=function(e){e.querySelector(".card__image").addEventListener("click",(function(e){K(e)}))},K=function(e){P.src=e.target.src,P.alt=e.target.alt,T.textContent=e.target.alt,E(O)};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);null!=r&&(t(o,r,n),o.forEach((function(c){return c.addEventListener("input",(function(){t(o,r,n),function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.textContent="",t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,n)}))})),e.addEventListener("submit",(function(){t(o,r,n)})))}(n,e)}))}({formSelector:".pop-up",inputSelector:".pop-up__item",submitButtonSelector:".pop-up__submit",inactiveButtonClass:"pop-up__submit_disabled",inputErrorClass:"pop-up__item_type_error",errorClass:"pop-up__item-error_active"}),x.addEventListener("submit",(function(){C.querySelector(".pop-up__submit").textContent="Сохранение";var e={};e.link=j.value,e.name=B.value,function(e,t){return fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return o(e)}))}(e.name,e.link).catch((function(e){console.log(e)})).then((function(e){c().then((function(e){return N(),e})).then((function(e){return D(e),e})).catch((function(e){console.log(e)})).finally((function(e){k(C),C.querySelector(".pop-up__submit").textContent="Сохранить",B.value="",j.value=""}))}))})),A.addEventListener("click",(function(){E(C)})),l.addEventListener("click",(function(){s.value=f.textContent,d.value=p.textContent,E(i)})),a.addEventListener("submit",(function(e){var t,c;i.querySelector(".pop-up__submit").textContent="Сохранение",e.preventDefault(),(t=s.value,c=d.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:c})}).then((function(e){return o(e)}))).then(r().then((function(e){S(e.name,e.about)})).catch((function(e){console.log(e)})).finally((function(e){i.querySelector(".pop-up__submit").textContent="Сохранить",k(i)})))})),v.addEventListener("click",(function(){E(h)})),y.addEventListener("submit",(function(){h.querySelector(".pop-up__submit").textContent="Сохранение";var e,t=h.querySelector("#ava-link");(e=t.value,fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:e})}).then((function(e){return o(e)}))).then((function(e){return b(e.avatar),e})).catch((function(e){console.log(e)})).finally((function(e){k(h),t.value="",h.querySelector(".pop-up__submit").textContent="Сохранить"}))})),q.forEach((function(e){e.addEventListener("mousedown",(function(t){!t.target.classList.contains("pop-up_is-closed")&&t.target.classList.contains("pop-up")&&k(e),t.target.classList.contains("pop-up__close")&&k(e)}))}));var Q="";r().then((function(e){return Q=e._id,e})).then((function(e){return S(e.name,e.about),b(e.avatar),e})).catch((function(e){console.log(e)})),c().then((function(e){D(e)})).catch((function(e){console.log(e)}))})();